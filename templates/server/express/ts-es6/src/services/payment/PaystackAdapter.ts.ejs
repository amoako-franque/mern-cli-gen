<% if (payment==='paystack' ) { %>
    import axios from 'axios';
    import crypto from 'crypto';
    import { PaymentProvider, CheckoutSessionOptions } from './PaymentProvider.js';

    export class PaystackAdapter implements PaymentProvider {
    public name = 'paystack';
    private secretKey: string;

    constructor() {
    this.secretKey = process.env.PAYSTACK_SECRET_KEY || '';
    if (!this.secretKey) {
    throw new Error('PAYSTACK_SECRET_KEY is not defined');
    }
    }

    async createCheckoutSession(options: CheckoutSessionOptions): Promise<{ url: string; sessionId: string }> {
        const response = await axios.post(
        'https://api.paystack.co/transaction/initialize',
        {
        email: options.customerEmail,
        amount: options.amount, // Paystack amount is in kobo/cents
        callback_url: options.successUrl,
        metadata: options.metadata,
        },
        {
        headers: {
        Authorization: `Bearer ${this.secretKey}`,
        'Content-Type': 'application/json',
        },
        }
        );

        return {
        url: response.data.data.authorization_url,
        sessionId: response.data.data.reference,
        };
        }

        async verifyWebhook(payload: any, signature: string): Promise<{ success: boolean; data: any }> {
            const hash = crypto
            .createHmac('sha512', this.secretKey)
            .update(JSON.stringify(payload))
            .digest('hex');

            if (hash === signature) {
            return {
            success: true,
            data: payload,
            };
            }

            return {
            success: false,
            data: null,
            };
            }
            }
            <% } %>