<% if (payment !=='none' ) { %>
    const { z } = require('zod');
    const { paymentService } = require('../services/payment/PaymentService');

    const checkoutSchema = z.object({
    amount: z.number().positive('Amount must be positive'),
    currency: z.string().length(3).optional().default('usd'),
    successUrl: z.string().url().optional(),
    cancelUrl: z.string().url().optional(),
    });

    const createCheckoutSession = async (req, res) => {
    try {
    const validatedData = checkoutSchema.parse(req.body);
    const { amount, currency, successUrl, cancelUrl } = validatedData;
    const customerEmail = req.user ? req.user.email : 'customer@example.com';

    const session = await paymentService.getProvider().createCheckoutSession({
    amount,
    currency: currency || 'usd',
    customerEmail,
    successUrl,
    cancelUrl,
    metadata: {
    userId: req.user ? req.user.id : null
    }
    });

    res.json(session);
    } catch (error) {
    if (error instanceof z.ZodError) {
    return res.status(400).json({ message: 'Validation failed', errors: error.errors });
    }
    res.status(500).json({ message: error.message });
    }
    };

    const handleWebhook = async (req, res) => {
    const signature = req.headers['stripe-signature'] || req.headers['x-paystack-signature'] || '';

    try {
    const result = await paymentService.getProvider().verifyWebhook(req.body, signature);

    if (result.success) {
    res.status(200).send('Webhook handled successfully');
    } else {
    res.status(400).send('Webhook verification failed');
    }
    } catch (error) {
    res.status(500).json({ message: error.message });
    }
    };

    module.exports = {
    createCheckoutSession,
    handleWebhook
    };
    <% } %>