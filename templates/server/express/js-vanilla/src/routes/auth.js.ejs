<% if (auth==='passport' ) { %>
    const express = require('express');
    const passport = require('passport');

    const router = express.Router();

    const CLIENT_URL = process.env.CLIENT_URL || "http://localhost:5173";

    // Local Auth
    router.post('/login', (req, res, next) => {
    passport.authenticate('local', (err, user, info) => {
    if (err) return next(err);
    if (!user) return res.status(401).json({ message: info.message || 'Login failed' });

    req.logIn(user, (err) => {
    if (err) return next(err);
    return res.json({ message: 'Login successful', user });
    });
    })(req, res, next);
    });

    // Google Auth
    router.get('/google', passport.authenticate('google', { scope: ['profile', 'email'] }));

    router.get('/google/callback',
    passport.authenticate('google', {
    successRedirect: CLIENT_URL,
    failureRedirect: `${CLIENT_URL}/login`
    })
    );

    // GitHub Auth
    router.get('/github', passport.authenticate('github', { scope: ['user:email'] }));

    router.get('/github/callback',
    passport.authenticate('github', {
    successRedirect: CLIENT_URL,
    failureRedirect: `${CLIENT_URL}/login`
    })
    );

    // Logout
    router.get('/logout', (req, res, next) => {
    req.logout((err) => {
    if (err) return next(err);
    res.redirect(CLIENT_URL);
    });
    });

    // Get Current User
    router.get('/me', (req, res) => {
    if (req.isAuthenticated()) {
    res.json(req.user);
    } else {
    res.status(401).json({ message: 'Not authenticated' });
    }
    });

    module.exports = router;
    <% } else { %>
        const express = require('express');
        const { register, login, getMe, logout } = require('../controllers/authController');
        const { protect } = require('../middleware/auth');

        const router = express.Router();

        router.post('/register', register);
        router.post('/login', login);
        router.get('/me', protect, getMe);
        router.post('/logout', logout);

        module.exports = router;
        <% } %>