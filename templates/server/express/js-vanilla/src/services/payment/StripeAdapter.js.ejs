<% if (payment==='stripe' ) { %>
    const Stripe = require('stripe');

    class StripeAdapter {
    constructor() {
    this.name = 'stripe';
    const apiKey = process.env.STRIPE_SECRET_KEY;
    if (!apiKey) {
    throw new Error('STRIPE_SECRET_KEY is not defined');
    }
    this.stripe = new Stripe(apiKey);
    }

    async createCheckoutSession(options) {
    const session = await this.stripe.checkout.sessions.create({
    payment_method_types: ['card'],
    line_items: [
    {
    price_data: {
    currency: options.currency,
    product_data: {
    name: 'Order Payment',
    },
    unit_amount: options.amount,
    },
    quantity: 1,
    },
    ],
    mode: 'payment',
    success_url: options.successUrl,
    cancel_url: options.cancelUrl,
    customer_email: options.customerEmail,
    metadata: options.metadata,
    });

    return {
    url: session.url || '',
    sessionId: session.id,
    };
    }

    async verifyWebhook(payload, signature) {
    const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;
    if (!webhookSecret) {
    throw new Error('STRIPE_WEBHOOK_SECRET is not defined');
    }

    try {
    const event = this.stripe.webhooks.constructEvent(payload, signature, webhookSecret);
    return {
    success: true,
    data: event,
    };
    } catch (err) {
    console.error('Stripe webhook verification failed:', err.message);
    return {
    success: false,
    data: err,
    };
    }
    }
    }

    module.exports = { StripeAdapter };
    <% } %>