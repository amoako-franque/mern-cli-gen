name: Docker Build and Push

on:
push:
tags:
- 'v*'

jobs:
build:
<% if (cicd==='github' && docker) { %>
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Docker Buildx
    uses: docker/setup-buildx-action@v3

    - name: Login to Docker Hub
    uses: docker/login-action@v3
    with:
    username: ${{ secrets.DOCKERHUB_USERNAME }}
    password: ${{ secrets.DOCKERHUB_TOKEN }}

    <% if (mode==='full' ) { %>
        - name: Build and Push Client
        uses: docker/build-push-action@v5
        with:
        context: ./client
        push: true
        tags: ${{ secrets.DOCKERHUB_USERNAME }}/<%= projectName %>-client:latest

            - name: Build and Push Server
            uses: docker/build-push-action@v5
            with:
            context: ./server
            push: true
            tags: ${{ secrets.DOCKERHUB_USERNAME }}/<%= projectName %>-server:latest
                <% } else if (mode==='frontend' ) { %>
                    - name: Build and Push Frontend
                    uses: docker/build-push-action@v5
                    with:
                    context: .
                    push: true
                    tags: ${{ secrets.DOCKERHUB_USERNAME }}/<%= projectName %>-frontend:latest
                        <% } else if (mode==='backend' ) { %>
                            - name: Build and Push Backend
                            uses: docker/build-push-action@v5
                            with:
                            context: .
                            push: true
                            tags: ${{ secrets.DOCKERHUB_USERNAME }}/<%= projectName %>-backend:latest
                                <% } %>
                                    <% } %>